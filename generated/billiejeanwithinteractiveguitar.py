from midiutil import MIDIFile
import pygame.midi
from pynput import keyboard
import time
midi = MIDIFile(1)
midi.addTempo(0, 0, 118)
time_signature = ( 4 ,  4 )
midi.addTimeSignature(0, 0, *time_signature, 24)
midi.addProgramChange(0, 0, 0, 9)
midi.addNote(0, 9, 36,0.0 ,1, 95)
midi.addNote(0, 9, 42,0.0 ,1, 90)
midi.addNote(0, 9, 42,0.5 ,1, 90)
midi.addNote(0, 9, 38,1.0 ,1, 90)
midi.addNote(0, 9, 42,1.5 ,1, 90)
midi.addNote(0, 9, 42,1.5 ,1, 90)
midi.addNote(0, 9, 36,2.0 ,1, 95)
midi.addNote(0, 9, 42,2.0 ,1, 90)
midi.addNote(0, 9, 42,2.5 ,1, 90)
midi.addNote(0, 9, 38,3.0 ,1, 90)
midi.addNote(0, 9, 42,3.5 ,1, 90)
midi.addNote(0, 9, 42,3.5 ,1, 90)
midi.addNote(0, 9, 36,4.0 ,1, 95)
midi.addNote(0, 9, 42,4.0 ,1, 90)
midi.addNote(0, 9, 42,4.5 ,1, 90)
midi.addNote(0, 9, 38,5.0 ,1, 90)
midi.addNote(0, 9, 42,5.5 ,1, 90)
midi.addNote(0, 9, 42,5.5 ,1, 90)
midi.addNote(0, 9, 36,6.0 ,1, 95)
midi.addNote(0, 9, 42,6.0 ,1, 90)
midi.addNote(0, 9, 42,6.5 ,1, 90)
midi.addNote(0, 9, 38,7.0 ,1, 90)
midi.addNote(0, 9, 42,7.5 ,1, 90)
midi.addNote(0, 9, 42,7.5 ,1, 90)
midi.addNote(0, 9, 36,8.0 ,1, 95)
midi.addNote(0, 9, 42,8.0 ,1, 90)
midi.addNote(0, 9, 42,8.5 ,1, 90)
midi.addNote(0, 9, 38,9.0 ,1, 90)
midi.addNote(0, 9, 42,9.5 ,1, 90)
midi.addNote(0, 9, 42,9.5 ,1, 90)
midi.addNote(0, 9, 36,10.0 ,1, 95)
midi.addNote(0, 9, 42,10.0 ,1, 90)
midi.addNote(0, 9, 42,10.5 ,1, 90)
midi.addNote(0, 9, 38,11.0 ,1, 90)
midi.addNote(0, 9, 42,11.5 ,1, 90)
midi.addNote(0, 9, 42,11.5 ,1, 90)
midi.addNote(0, 9, 36,12.0 ,1, 95)
midi.addNote(0, 9, 42,12.0 ,1, 90)
midi.addNote(0, 9, 42,12.5 ,1, 90)
midi.addNote(0, 9, 38,13.0 ,1, 90)
midi.addNote(0, 9, 42,13.5 ,1, 90)
midi.addNote(0, 9, 42,13.5 ,1, 90)
midi.addNote(0, 9, 36,14.0 ,1, 95)
midi.addNote(0, 9, 42,14.0 ,1, 90)
midi.addNote(0, 9, 42,14.5 ,1, 90)
midi.addNote(0, 9, 38,15.0 ,1, 90)
midi.addNote(0, 9, 42,15.5 ,1, 90)
midi.addNote(0, 9, 42,15.5 ,1, 90)
midi.addNote(0, 9, 36,16.0 ,1, 95)
midi.addNote(0, 9, 42,16.0 ,1, 90)
midi.addNote(0, 9, 42,16.5 ,1, 90)
midi.addNote(0, 9, 38,17.0 ,1, 90)
midi.addNote(0, 9, 42,17.5 ,1, 90)
midi.addNote(0, 9, 42,17.5 ,1, 90)
midi.addNote(0, 9, 36,18.0 ,1, 95)
midi.addNote(0, 9, 42,18.0 ,1, 90)
midi.addNote(0, 9, 42,18.5 ,1, 90)
midi.addNote(0, 9, 38,19.0 ,1, 90)
midi.addNote(0, 9, 42,19.5 ,1, 90)
midi.addNote(0, 9, 42,19.5 ,1, 90)
midi.addNote(0, 9, 36,20.0 ,1, 95)
midi.addNote(0, 9, 42,20.0 ,1, 90)
midi.addNote(0, 9, 42,20.5 ,1, 90)
midi.addNote(0, 9, 38,21.0 ,1, 90)
midi.addNote(0, 9, 42,21.5 ,1, 90)
midi.addNote(0, 9, 42,21.5 ,1, 90)
midi.addNote(0, 9, 36,22.0 ,1, 95)
midi.addNote(0, 9, 42,22.0 ,1, 90)
midi.addNote(0, 9, 42,22.5 ,1, 90)
midi.addNote(0, 9, 38,23.0 ,1, 90)
midi.addNote(0, 9, 42,23.5 ,1, 90)
midi.addNote(0, 9, 42,23.5 ,1, 90)
midi.addNote(0, 9, 36,24.0 ,1, 95)
midi.addNote(0, 9, 42,24.0 ,1, 90)
midi.addNote(0, 9, 42,24.5 ,1, 90)
midi.addNote(0, 9, 38,25.0 ,1, 90)
midi.addNote(0, 9, 42,25.5 ,1, 90)
midi.addNote(0, 9, 42,25.5 ,1, 90)
midi.addNote(0, 9, 36,26.0 ,1, 95)
midi.addNote(0, 9, 42,26.0 ,1, 90)
midi.addNote(0, 9, 42,26.5 ,1, 90)
midi.addNote(0, 9, 38,27.0 ,1, 90)
midi.addNote(0, 9, 42,27.5 ,1, 90)
midi.addNote(0, 9, 42,27.5 ,1, 90)
midi.addNote(0, 9, 36,28.0 ,1, 95)
midi.addNote(0, 9, 42,28.0 ,1, 90)
midi.addNote(0, 9, 42,28.5 ,1, 90)
midi.addNote(0, 9, 38,29.0 ,1, 90)
midi.addNote(0, 9, 42,29.5 ,1, 90)
midi.addNote(0, 9, 42,29.5 ,1, 90)
midi.addNote(0, 9, 36,30.0 ,1, 95)
midi.addNote(0, 9, 42,30.0 ,1, 90)
midi.addNote(0, 9, 42,30.5 ,1, 90)
midi.addNote(0, 9, 38,31.0 ,1, 90)
midi.addNote(0, 9, 42,31.5 ,1, 90)
midi.addNote(0, 9, 42,31.5 ,1, 90)
midi.addNote(0, 9, 36,32.0 ,1, 95)
midi.addNote(0, 9, 42,32.0 ,1, 90)
midi.addNote(0, 9, 42,32.5 ,1, 90)
midi.addNote(0, 9, 38,33.0 ,1, 90)
midi.addNote(0, 9, 42,33.5 ,1, 90)
midi.addNote(0, 9, 42,33.5 ,1, 90)
midi.addNote(0, 9, 36,34.0 ,1, 95)
midi.addNote(0, 9, 42,34.0 ,1, 90)
midi.addNote(0, 9, 42,34.5 ,1, 90)
midi.addNote(0, 9, 38,35.0 ,1, 90)
midi.addNote(0, 9, 42,35.5 ,1, 90)
midi.addNote(0, 9, 42,35.5 ,1, 90)
midi.addNote(0, 9, 36,36.0 ,1, 95)
midi.addNote(0, 9, 42,36.0 ,1, 90)
midi.addNote(0, 9, 42,36.5 ,1, 90)
midi.addNote(0, 9, 38,37.0 ,1, 90)
midi.addNote(0, 9, 42,37.5 ,1, 90)
midi.addNote(0, 9, 42,37.5 ,1, 90)
midi.addNote(0, 9, 36,38.0 ,1, 95)
midi.addNote(0, 9, 42,38.0 ,1, 90)
midi.addNote(0, 9, 42,38.5 ,1, 90)
midi.addNote(0, 9, 38,39.0 ,1, 90)
midi.addNote(0, 9, 42,39.5 ,1, 90)
midi.addNote(0, 9, 42,39.5 ,1, 90)
midi.addNote(0, 9, 36,40.0 ,1, 95)
midi.addNote(0, 9, 42,40.0 ,1, 90)
midi.addNote(0, 9, 42,40.5 ,1, 90)
midi.addNote(0, 9, 38,41.0 ,1, 90)
midi.addNote(0, 9, 42,41.5 ,1, 90)
midi.addNote(0, 9, 42,41.5 ,1, 90)
midi.addNote(0, 9, 36,42.0 ,1, 95)
midi.addNote(0, 9, 42,42.0 ,1, 90)
midi.addNote(0, 9, 42,42.5 ,1, 90)
midi.addNote(0, 9, 38,43.0 ,1, 90)
midi.addNote(0, 9, 42,43.5 ,1, 90)
midi.addNote(0, 9, 42,43.5 ,1, 90)
midi.addNote(0, 9, 36,44.0 ,1, 95)
midi.addNote(0, 9, 42,44.0 ,1, 90)
midi.addNote(0, 9, 42,44.5 ,1, 90)
midi.addNote(0, 9, 38,45.0 ,1, 90)
midi.addNote(0, 9, 42,45.5 ,1, 90)
midi.addNote(0, 9, 42,45.5 ,1, 90)
midi.addNote(0, 9, 36,46.0 ,1, 95)
midi.addNote(0, 9, 42,46.0 ,1, 90)
midi.addNote(0, 9, 42,46.5 ,1, 90)
midi.addNote(0, 9, 38,47.0 ,1, 90)
midi.addNote(0, 9, 42,47.5 ,1, 90)
midi.addNote(0, 9, 42,47.5 ,1, 90)
midi.addNote(0, 9, 36,48.0 ,1, 95)
midi.addNote(0, 9, 42,48.0 ,1, 90)
midi.addNote(0, 9, 42,48.5 ,1, 90)
midi.addNote(0, 9, 38,49.0 ,1, 90)
midi.addNote(0, 9, 42,49.5 ,1, 90)
midi.addNote(0, 9, 42,49.5 ,1, 90)
midi.addNote(0, 9, 36,50.0 ,1, 95)
midi.addNote(0, 9, 42,50.0 ,1, 90)
midi.addNote(0, 9, 42,50.5 ,1, 90)
midi.addNote(0, 9, 38,51.0 ,1, 90)
midi.addNote(0, 9, 42,51.5 ,1, 90)
midi.addNote(0, 9, 42,51.5 ,1, 90)
midi.addNote(0, 9, 36,52.0 ,1, 95)
midi.addNote(0, 9, 42,52.0 ,1, 90)
midi.addNote(0, 9, 42,52.5 ,1, 90)
midi.addNote(0, 9, 38,53.0 ,1, 90)
midi.addNote(0, 9, 42,53.5 ,1, 90)
midi.addNote(0, 9, 42,53.5 ,1, 90)
midi.addNote(0, 9, 36,54.0 ,1, 95)
midi.addNote(0, 9, 42,54.0 ,1, 90)
midi.addNote(0, 9, 42,54.5 ,1, 90)
midi.addNote(0, 9, 38,55.0 ,1, 90)
midi.addNote(0, 9, 42,55.5 ,1, 90)
midi.addNote(0, 9, 42,55.5 ,1, 90)
midi.addNote(0, 9, 36,56.0 ,1, 95)
midi.addNote(0, 9, 42,56.0 ,1, 90)
midi.addNote(0, 9, 42,56.5 ,1, 90)
midi.addNote(0, 9, 38,57.0 ,1, 90)
midi.addNote(0, 9, 42,57.5 ,1, 90)
midi.addNote(0, 9, 42,57.5 ,1, 90)
midi.addNote(0, 9, 36,58.0 ,1, 95)
midi.addNote(0, 9, 42,58.0 ,1, 90)
midi.addNote(0, 9, 42,58.5 ,1, 90)
midi.addNote(0, 9, 38,59.0 ,1, 90)
midi.addNote(0, 9, 42,59.5 ,1, 90)
midi.addNote(0, 9, 42,59.5 ,1, 90)
midi.addNote(0, 9, 36,60.0 ,1, 95)
midi.addNote(0, 9, 42,60.0 ,1, 90)
midi.addNote(0, 9, 42,60.5 ,1, 90)
midi.addNote(0, 9, 38,61.0 ,1, 90)
midi.addNote(0, 9, 42,61.5 ,1, 90)
midi.addNote(0, 9, 42,61.5 ,1, 90)
midi.addNote(0, 9, 36,62.0 ,1, 95)
midi.addNote(0, 9, 42,62.0 ,1, 90)
midi.addNote(0, 9, 42,62.5 ,1, 90)
midi.addNote(0, 9, 38,63.0 ,1, 90)
midi.addNote(0, 9, 42,63.5 ,1, 90)
midi.addNote(0, 9, 42,63.5 ,1, 90)
midi.addNote(0, 9, 36,64.0 ,1, 95)
midi.addNote(0, 9, 42,64.0 ,1, 90)
midi.addNote(0, 9, 42,64.5 ,1, 90)
midi.addNote(0, 9, 38,65.0 ,1, 90)
midi.addNote(0, 9, 42,65.5 ,1, 90)
midi.addNote(0, 9, 42,65.5 ,1, 90)
midi.addNote(0, 9, 36,66.0 ,1, 95)
midi.addNote(0, 9, 42,66.0 ,1, 90)
midi.addNote(0, 9, 42,66.5 ,1, 90)
midi.addNote(0, 9, 38,67.0 ,1, 90)
midi.addNote(0, 9, 42,67.5 ,1, 90)
midi.addNote(0, 9, 42,67.5 ,1, 90)
with open("./output/billieJeanWithInteractiveGuitar.mid", "wb") as output_file:
   midi.writeFile(output_file)


print('click esc to stop')
# Initialize pygame.midi
pygame.midi.init()
midi_output = pygame.midi.Output(0)  # Open the first MIDI port
instrument = 25
midi_output.set_instrument(instrument)
key_to_note = {
    'c': 60,
    'd': 62,
    'e': 64,
    'f': 65,
    'g': 67,
    'a': 69,
    'b': 71,
}
# Track which keys are currently pressed and their start times
keys_pressed = {}
start_time = time.time()
def on_press(key):
    try:
        if key.char in key_to_note and key.char not in keys_pressed:
            note = key_to_note[key.char]
            print(f"Playing note: {note}")
            midi_output.note_on(note, 100)  # Note on with velocity 100
            keys_pressed[key.char] = time.time()  # Record the start time of the note
    except AttributeError:
        pass


def on_release(key):
    try:
        if key.char in key_to_note and key.char in keys_pressed:
            note = key_to_note[key.char]
            midi_output.note_off(note, 100)  # Note off with velocity 100
            keys_pressed.pop(key.char)
    except AttributeError:
        pass
    if key == keyboard.Key.esc:
        # Save the MIDI file and exit program when Esc key is pressed
        pygame.midi.quit()
        return False
        
# Collect keyboard events
listener = keyboard.Listener(
    on_press=on_press,
    on_release=on_release
)
listener.start()
listener.join()
